<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML5视频API功能测试</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        header {
            background: linear-gradient(90deg, #4b6cb7 0%, #182848 100%);
            color: white;
            padding: 25px 30px;
            text-align: center;
            position: relative;
        }
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        .back-btn {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s;
        }
        .back-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        .content {
            padding: 25px;
        }
        h2 {
            margin-bottom: 20px;
            color: #182848;
            font-size: 1.5rem;
            padding-bottom: 10px;
            border-bottom: 2px solid #eaeaea;
        }
        .test-section {
            margin-bottom: 30px;
        }
        .test-group {
            margin-bottom: 20px;
        }
        .format-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #4b6cb7;
        }
        .api-options {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        .format-btn {
            padding: 12px 15px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 500;
        }
        .format-btn:hover {
            border-color: #4b6cb7;
            background: #f0f4ff;
        }
        .format-btn.active {
            background: #4b6cb7;
            color: white;
            border-color: #4b6cb7;
        }
        .test-btn {
            padding: 12px 25px;
            background: #4b6cb7;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .test-btn:hover {
            background: #3a5a9c;
        }
        .status {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-top: 15px;
        }
        .status h3 {
            margin-bottom: 10px;
            color: #182848;
        }
        .status-info {
            font-size: 0.95rem;
        }
        .status-item {
            margin-bottom: 8px;
            display: flex;
        }
        .status-label {
            font-weight: 600;
            width: 200px;
        }
        .status-value {
            flex: 1;
        }
        .compatibility-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        .compatible {
            background: #e8f5e9;
            color: #2e7d32;
        }
        .incompatible {
            background: #ffebee;
            color: #c62828;
        }
        .unknown {
            background: #fff3e0;
            color: #ef6c00;
        }
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #4b6cb7;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .results-table th,
        .results-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #eaeaea;
        }
        .results-table th {
            background: #f8f9fa;
            font-weight: 600;
        }
        .results-section {
            margin-bottom: 20px;
        }
        .results-section h4 {
            margin: 20px 0 10px;
            color: #182848;
            font-size: 1.1rem;
        }
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .stat-number {
            font-size: 1.8rem;
            font-weight: bold;
            color: #4b6cb7;
        }
        .stat-label {
            font-size: 0.9rem;
            color: #666;
        }
        @media (max-width: 768px) {
            .api-options {
                grid-template-columns: 1fr;
            }
            .summary-stats {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <button class="back-btn" onclick="window.location.href='format_test.html'">← 返回主页</button>
            <h1>HTML5视频API功能测试</h1>
            <p class="subtitle">测试HTML5视频相关API的功能和兼容性</p>
        </header>
        
        <div class="content">
            <div class="info-box">
                <p>此页面测试HTML5视频API的功能支持情况，包括canPlayType检测、MediaSource API、视频编解码器支持等。</p>
            </div>
            
            <div class="test-section">
                <h2>canPlayType API测试</h2>
                <button class="test-btn" id="canPlayTypeTestBtn">开始canPlayType测试</button>
                
                <div class="status">
                    <h3>canPlayType测试结果</h3>
                    <div class="status-info">
                        <div class="summary-stats" id="canPlayTypeSummary">
                            <!-- 统计信息将动态生成 -->
                        </div>
                        
                        <div class="results-section">
                            <h4>容器格式支持</h4>
                            <table class="results-table" id="canPlayTypeContainerResults">
                                <thead>
                                    <tr>
                                        <th>容器格式</th>
                                        <th>MIME类型</th>
                                        <th>支持状态</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- 容器格式结果将动态生成 -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="results-section">
                            <h4>编码格式支持</h4>
                            <table class="results-table" id="canPlayTypeCodecResults">
                                <thead>
                                    <tr>
                                        <th>编码格式</th>
                                        <th>MIME类型</th>
                                        <th>支持状态</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- 编码格式结果将动态生成 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="test-section">
                <h2>MediaSource API测试</h2>
                <button class="test-btn" id="mediaSourceTestBtn">测试MediaSource API</button>
                
                <div class="status">
                    <h3>MediaSource API测试结果</h3>
                    <div class="status-info" id="mediaSourceResults">
                        <div class="status-item">
                            <span class="status-label">MediaSource支持:</span>
                            <span class="status-value" id="mediaSourceSupport">检测中...</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">SourceBuffer支持:</span>
                            <span class="status-value" id="sourceBufferSupport">检测中...</span>
                        </div>
                        
                        <div class="summary-stats" id="mediaSourceSummary">
                            <!-- 统计信息将动态生成 -->
                        </div>
                        
                        <div class="results-section">
                            <h4>视频编码格式支持</h4>
                            <table class="results-table" id="codecSupportTable">
                                <thead>
                                    <tr>
                                        <th>编码格式</th>
                                        <th>MIME类型</th>
                                        <th>支持状态</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- 编码格式测试结果将动态生成 -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="results-section">
                            <h4>容器格式支持</h4>
                            <table class="results-table" id="containerSupportTable">
                                <thead>
                                    <tr>
                                        <th>容器格式</th>
                                        <th>MIME类型</th>
                                        <th>支持状态</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- 容器格式测试结果将动态生成 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const canPlayTypeTestBtn = document.getElementById('canPlayTypeTestBtn');
            const mediaSourceTestBtn = document.getElementById('mediaSourceTestBtn');
            
            // canPlayType测试
            canPlayTypeTestBtn.addEventListener('click', testCanPlayType);
            
            // MediaSource API测试
            mediaSourceTestBtn.addEventListener('click', testMediaSourceAPI);
            
            // 视频编码格式定义
            const videoCodecs = {
                'avc': {
                    mime: 'video/mp4; codecs="avc1.42E01E"',
                    name: 'H.264/AVC'
                },
                'hevc': {
                    mime: 'video/mp4; codecs="hev1.1.6.L93.B0"',
                    name: 'H.265/HEVC'
                },
                'mpeg4': {
                    mime: 'video/mp4; codecs="mp4v.20.8"',
                    name: 'MPEG-4'
                },
                'mpeg2': {
                    mime: 'video/mpeg; codecs="mp2v"',
                    name: 'MPEG-2'
                },
                'vp8': {
                    mime: 'video/webm; codecs="vp8"',
                    name: 'VP8'
                },
                'vp9': {
                    mime: 'video/webm; codecs="vp9"',
                    name: 'VP9'
                },
                'av1': {
                    mime: 'video/webm; codecs="av1"',
                    name: 'AV1'
                },
                'wmv2': {
                    mime: 'video/x-ms-wmv; codecs="WMV2"',
                    name: 'WMV2'
                },
                'vvc': {
                    mime: 'video/mp4; codecs="vvc1.1.6.L93.B0"',
                    name: 'H.266/VVC'
                }
            };
            
            // 容器格式定义
            const containerFormats = {
                'mp4': {
                    mime: 'video/mp4',
                    name: 'MP4'
                },
                'webm': {
                    mime: 'video/webm',
                    name: 'WebM'
                },
                'flv': {
                    mime: 'video/x-flv',
                    name: 'FLV'
                },
                'gif': {
                    mime: 'image/gif',
                    name: 'GIF'
                },
                'm4v': {
                    mime: 'video/x-m4v',
                    name: 'M4V'
                },
                'mkv': {
                    mime: 'video/x-matroska',
                    name: 'MKV'
                },
                'mov': {
                    mime: 'video/quicktime',
                    name: 'MOV'
                },
                'mpegps': {
                    mime: 'video/mpeg',
                    name: 'MPEG-PS'
                },
                'ts': {
                    mime: 'video/mp2t',
                    name: 'MPEG-TS'
                },
                'wmv': {
                    mime: 'video/x-ms-wmv',
                    name: 'WMV'
                },
                'ogv': {
                    mime: 'video/ogg',
                    name: 'OGV'
                }
            };
            
            function testCanPlayType() {
                const video = document.createElement('video');
                
                // 测试容器格式支持
                const containerResultsBody = document.querySelector('#canPlayTypeContainerResults tbody');
                containerResultsBody.innerHTML = '';
                
                let containerProbably = 0;
                let containerMaybe = 0;
                let containerNo = 0;
                
                Object.keys(containerFormats).forEach(containerKey => {
                    const container = containerFormats[containerKey];
                    const result = video.canPlayType(container.mime);
                    
                    const { statusBadge, statusText } = getCanPlayTypeStatus(result);
                    
                    // 统计结果
                    if (result === 'probably') containerProbably++;
                    else if (result === 'maybe') containerMaybe++;
                    else containerNo++;
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${container.name}</td>
                        <td><code>${container.mime}</code></td>
                        <td><span class="compatibility-badge ${statusBadge}">${statusText}</span></td>
                    `;
                    containerResultsBody.appendChild(row);
                });
                
                // 测试编码格式支持
                const codecResultsBody = document.querySelector('#canPlayTypeCodecResults tbody');
                codecResultsBody.innerHTML = '';
                
                let codecProbably = 0;
                let codecMaybe = 0;
                let codecNo = 0;
                
                Object.keys(videoCodecs).forEach(codecKey => {
                    const codec = videoCodecs[codecKey];
                    const result = video.canPlayType(codec.mime);
                    
                    const { statusBadge, statusText } = getCanPlayTypeStatus(result);
                    
                    // 统计结果
                    if (result === 'probably') codecProbably++;
                    else if (result === 'maybe') codecMaybe++;
                    else codecNo++;
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${codec.name}</td>
                        <td><code>${codec.mime}</code></td>
                        <td><span class="compatibility-badge ${statusBadge}">${statusText}</span></td>
                    `;
                    codecResultsBody.appendChild(row);
                });
                
                // 更新统计信息
                const totalContainer = Object.keys(containerFormats).length;
                const totalCodec = Object.keys(videoCodecs).length;
                
                document.getElementById('canPlayTypeSummary').innerHTML = `
                    <div class="stat-card">
                        <div class="stat-number">${totalContainer}</div>
                        <div class="stat-label">容器格式总数</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${containerProbably}</div>
                        <div class="stat-label">很可能支持</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${containerMaybe}</div>
                        <div class="stat-label">可能支持</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${containerNo}</div>
                        <div class="stat-label">不支持</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${totalCodec}</div>
                        <div class="stat-label">编码格式总数</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${codecProbably}</div>
                        <div class="stat-label">很可能支持</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${codecMaybe}</div>
                        <div class="stat-label">可能支持</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${codecNo}</div>
                        <div class="stat-label">不支持</div>
                    </div>
                `;
            }
            
            function testMediaSourceAPI() {
                const mediaSourceSupport = typeof MediaSource !== 'undefined';
                const sourceBufferSupport = mediaSourceSupport && typeof SourceBuffer !== 'undefined';
                
                document.getElementById('mediaSourceSupport').innerHTML = 
                    mediaSourceSupport ? 
                    '<span class="compatibility-badge compatible">支持</span>' : 
                    '<span class="compatibility-badge incompatible">不支持</span>';
                
                document.getElementById('sourceBufferSupport').innerHTML = 
                    sourceBufferSupport ? 
                    '<span class="compatibility-badge compatible">支持</span>' : 
                    '<span class="compatibility-badge incompatible">不支持</span>';
                
                // 测试编码格式支持
                const codecResultsBody = document.querySelector('#codecSupportTable tbody');
                codecResultsBody.innerHTML = '';
                
                let codecSupported = 0;
                let codecUnsupported = 0;
                
                if (mediaSourceSupport) {
                    Object.keys(videoCodecs).forEach(codecKey => {
                        const codec = videoCodecs[codecKey];
                        const supported = MediaSource.isTypeSupported(codec.mime);
                        
                        // 统计结果
                        if (supported) codecSupported++;
                        else codecUnsupported++;
                        
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${codec.name}</td>
                            <td><code>${codec.mime}</code></td>
                            <td><span class="compatibility-badge ${supported ? 'compatible' : 'incompatible'}">${supported ? '支持' : '不支持'}</span></td>
                        `;
                        codecResultsBody.appendChild(row);
                    });
                } else {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td colspan="3" style="text-align: center;">MediaSource API不可用</td>
                    `;
                    codecResultsBody.appendChild(row);
                }
                
                // 测试容器格式支持
                const containerResultsBody = document.querySelector('#containerSupportTable tbody');
                containerResultsBody.innerHTML = '';
                
                let containerSupported = 0;
                let containerUnsupported = 0;
                
                if (mediaSourceSupport) {
                    Object.keys(containerFormats).forEach(containerKey => {
                        const container = containerFormats[containerKey];
                        // 为容器格式添加一个常见的编码格式进行测试
                        let testMime = container.mime;
                        if (containerKey === 'mp4') {
                            testMime = 'video/mp4; codecs="avc1.42E01E"';
                        } else if (containerKey === 'webm') {
                            testMime = 'video/webm; codecs="vp8"';
                        } else if (containerKey === 'mov') {
                            testMime = 'video/quicktime; codecs="avc1.42E01E"';
                        }
                        
                        const supported = MediaSource.isTypeSupported(testMime);
                        
                        // 统计结果
                        if (supported) containerSupported++;
                        else containerUnsupported++;
                        
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${container.name}</td>
                            <td><code>${testMime}</code></td>
                            <td><span class="compatibility-badge ${supported ? 'compatible' : 'incompatible'}">${supported ? '支持' : '不支持'}</span></td>
                        `;
                        containerResultsBody.appendChild(row);
                    });
                } else {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td colspan="3" style="text-align: center;">MediaSource API不可用</td>
                    `;
                    containerResultsBody.appendChild(row);
                }
                
                // 更新统计信息
                const totalContainer = Object.keys(containerFormats).length;
                const totalCodec = Object.keys(videoCodecs).length;
                
                document.getElementById('mediaSourceSummary').innerHTML = `
                    <div class="stat-card">
                        <div class="stat-number">${totalContainer}</div>
                        <div class="stat-label">容器格式总数</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${containerSupported}</div>
                        <div class="stat-label">容器格式支持</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${containerUnsupported}</div>
                        <div class="stat-label">容器格式不支持</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${totalCodec}</div>
                        <div class="stat-label">编码格式总数</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${codecSupported}</div>
                        <div class="stat-label">编码格式支持</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${codecUnsupported}</div>
                        <div class="stat-label">编码格式不支持</div>
                    </div>
                `;
            }
            
            function getCanPlayTypeStatus(result) {
                let statusBadge = '';
                let statusText = '';
                
                switch(result) {
                    case 'probably':
                        statusBadge = 'compatible';
                        statusText = '很可能支持';
                        break;
                    case 'maybe':
                        statusBadge = 'unknown';
                        statusText = '可能支持';
                        break;
                    case '':
                        statusBadge = 'incompatible';
                        statusText = '不支持';
                        break;
                    default:
                        statusBadge = 'unknown';
                        statusText = result;
                }
                
                return { statusBadge, statusText };
            }
        });
    </script>
</body>
</html>